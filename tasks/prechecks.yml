---
- name: Check if vars have been provided
  ansible.builtin.assert:
    that:
      - network_name is defined and network_name in ["datil_test", "datil"]
      - root_email is defined and root_email | length > 0
      - ssh_user is defined and ssh_user | length > 0
      - ssh_public_key is defined and ssh_public_key | length > 0
      - provider is defined and provider | length > 0
      # - (provider == 'ovh' and provider_class in ["advance", "scale"]) or provider_class == ""
      - ansible_host is defined and ansible_host | length > 0
      - host_ip is defined and host_ip | length > 0
      - host_gw is defined and host_gw | length > 0
      - guest_ip is defined and guest_ip | length > 0
      - guest_gw is defined and guest_gw | length > 0
    fail_msg: "Error: Some required information was not provided, please revisit machine-description.yml"

# - name: Get BIOS Revision
#   become: true
#   command: dmidecode -t bios
#   register: bios_revision
# - name: Extract BIOS Revision
#   set_fact:
#     bios_revision_line: "{{ bios_revision.stdout_lines | select('search', 'BIOS Revision') | regex_search('([0-9.]+)') }}"
#     bios_vendor_line: "{{ bios_revision.stdout_lines | select('search', 'Vendor') | map('trim') | join('') }}"
# - name: Fail if outdated BIOS
#   fail:
#     msg: "Please manually upgrade your machine's BIOS\nLeaseweb: 2.15.3 or newer from https://www.dell.com/support/home/en-us/product-support/product/poweredge-r6515/drivers\nOVH: 5.22 or newer"
#   when: "('American Megatrends International' in bios_vendor_line and bios_revision_line is version('5.22', '<')) or ('Dell Inc' in bios_vendor_line and bios_revision_line is version('2.15', '<'))"